<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-transform"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <meta name="author" content="刀刀,daodaovps@qq.com">
    <link rel="icon" href="/usr/themes/yodu/images/favicon.ico">
    <link rel="apple-touch-icon" href="/usr/themes/yodu/images/favicon.ico">
    <!--[if lt IE 9]>
    <div class="browsehappy" role="dialog">当前网页 <strong>不支持</strong> 你正在使用的浏览器. 为了正常的访问, 请 <a
            href="http://browsehappy.com/">升级你的浏览器</a>.
    </div>
    <![endif]-->

    <title>Android集成微信支付和支付宝支付 -  Android集成微信支付和支付宝支付 | 刀刀博客</title>
    <link rel="stylesheet" href="/usr/themes/yodu/duoshuo.css" type="text/css">
    <link rel="stylesheet" href="/usr/themes/yodu/style.css">
    <link rel="stylesheet" href="/static/css/w3.css">

    <meta name="description"
          content="Android-Pay,Android集成微信支付和支付宝支付,wechat-alipay-android-integrated-payment-and-payment , Android集成微信支付和支付宝支付, 刀刀的个人博客,专注于分享优秀的开源项目."/>
    <meta name="keywords"
          content="Android集成微信支付和支付宝支付,wechat-alipay-android-integrated-payment-and-payment , Android集成微信支付和支付宝支付,   java,daodao,daodaoblog,github,opensource,freecode,开源项目."/>

</head>
<body id="menu">

<div class="js-search search-form search-form--modal" method="get" role="search">
    <div class="search-form__inner">
        <div><p class="micro mb-">输入后按回车搜索 ...</p> <a id="soux" href="https://s.github123.com/search/"><i
                class="icon-search"></i></a> <input id="keyword" class="text-input" type="text" name="s"
                                                    autocomplete="off"
                                                    placeholder="Search" onkeypress="$.getKey();" required="required"/>
        </div>
    </div>
    <div class="search_close" onclick="$.Close()"></div>
</div>

<sidebar id="sidebar">
    <div class="tx"><a href="/"><img src="/usr/themes/yodu/images/p1.jpg" alt="刀刀博客"/><span>刀刀博客</span></a></div>
    <ul class="cd">
        <li><a href="/" title="主页"> <i class="iconfont icon-quan"></i> <span>主页</span> </a></li>
        <li><a href="/archives.html" title="归档"> <i class="iconfont icon-openwj"></i> <span>归档</span>
        </a></li>
        <li><a href="/tags.html" title="标签"> <i class="iconfont icon-tags"></i> <span>标签</span> </a>
        </li>
        <li><a href="/about.html" title="关于"> <i class="iconfont icon-wo"></i> <span>关于</span> </a>
        </li>
        <li><a onclick="$.Sousuo()" title="搜索"> <i class="iconfont icon-search"></i> <span>搜索</span> </a>
        </li>
    </ul>
</sidebar>


<div id="header" class="header">
    <div class="sjcd" onclick="$.Menu()"><i></i></div>
    <h1><a href="/abount.html">刀刀博客</a></h1>
</div>
<div id="zhezhao" onclick="$.Menu()"></div>
<div class="bug">
    <div id="bug">
        <div id="main" class="main">

            <div class="w3-row">
                <div class="w3-col l8 ">
                    <article>
                        <h3 class="sider_header" style="padding-top: 48px"><strong><a
                                href="/page/35/wechat-alipay-android-integrated-payment-and-payment.html"><span
                                style='color:red'></span>Android集成微信支付和支付宝支付</a></strong>
                        </h3>

                        <div id="post" class="post">
                            <div class="meta">
                                <time itemprop="datePublished"
                                      content="2017-03-07">2017-03-07</time>
                                <span class="meta-value">
                                 <a   class="tag-img" style="background-image: url(/images/8cfea3e2805a43968e14668d8c609a8c);" href="/tag/1/1.html">Android</a>  <a   href="/tag/103/1.html">微信</a>  <a     href="/tag/102/1.html">支付宝</a>
                                </span>
                            </div>


                            <div class="content">

                                <div class="index-img" style="margin: 10px 0 20px 0">
                                    <div class="tutupage">

                                        <div id="img"
                                             style="display:block;left: 0px;top: 0px;width: 100%;background-size:cover;background-image: url(/images/new-bg-8);">
                                            <div id="imgtxt"
                                                 style="color: #FFF;display: block;font-weight:400;text-align: center;white-space: nowrap;overflow: hidden;">
                                            Android集成微信支付和支付宝支付
                                            </div>
                                        </div>

                                    </div>
                                </div>

                            <h2 id="h2-b816d8fb46d4440a84ed7f98c7a1affb">Android-Pay</h2><p>支持微信和支付宝两种主流支付的集成库， 两行代码实现微信支付， 三行代码实现支付宝支付</p>
<h2 id="h2-2d50ae7417ba49f28ac52f7bd2f02f83">引入</h2><h3 id="h3-gradle"><a href='' target='_blank'></a><span class="header-link octicon octicon-link"></span>gradle</h3><p>对应的项目中的build.gradle文件添加依赖：</p>
<pre><code class="lang-xml">dependencies {
    //添加支付库
    compile &#39;io.github.mayubao:pay_library:1.0.0&#39;
}
</code></pre>
<h3 id="h3-maven"><a href='' target='_blank'></a><span class="header-link octicon octicon-link"></span>maven</h3><pre><code class="lang-xml">&lt;dependency&gt;
  &lt;groupId&gt;io.github.mayubao&lt;/groupId&gt;
  &lt;artifactId&gt;pay_library&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
  &lt;type&gt;pom&lt;/type&gt;
&lt;/dependency&gt;
</code></pre>
<h2 id="h2-b06495af061c4f9badb29196d0dc0202">使用</h2><h3 id="h3-u5FAEu4FE1u652Fu4ED8u4F7Fu7528"><a href='' target='_blank'></a><span class="header-link octicon octicon-link"></span>微信支付使用</h3><pre><code class="lang-java">        //1.创建微信支付请求
        WechatPayReq wechatPayReq = new WechatPayReq.Builder()
                .with(this) //activity实例
                .setAppId(appid) //微信支付AppID
                .setPartnerId(partnerid)//微信支付商户号
                .setPrepayId(prepayid)//预支付码
//                                .setPackageValue(wechatPayReq.get)//&quot;Sign=WXPay&quot;
                .setNonceStr(noncestr)
                .setTimeStamp(timestamp)//时间戳
                .setSign(sign)//签名
                .create();
        //2.发送微信支付请求
        PayAPI.getInstance().sendPayRequest(wechatPayReq);


        //关于微信支付的回调
        //wechatPayReq.setOnWechatPayListener(new OnWechatPayListener);
</code></pre>
<blockquote>
<p>注意：这里没有金额设置，金额的信息已经包含在预支付码prepayid了。</p>
</blockquote>
<h3 id="h3-u652Fu4ED8u5B9Du652Fu4ED8u4F7Fu7528"><a href='' target='_blank'></a><span class="header-link octicon octicon-link"></span>支付宝支付使用</h3><h4 id="h4--"><a href='' target='_blank'></a><span class="header-link octicon octicon-link"></span>支付宝支付第一种方式(不建议用这种方式，商户私钥暴露在客户端，极其危险，推荐用第二种支付方式)</h4><pre><code class="lang-java">
        //1.创建支付宝支付配置
        AliPayAPI.Config config = new AliPayAPI.Config.Builder()
                .setRsaPrivate(rsa_private) //设置私钥 (商户私钥，pkcs8格式)
                .setRsaPublic(rsa_public)//设置公钥(// 支付宝公钥)
                .setPartner(partner) //设置商户
                .setSeller(seller) //设置商户收款账号
                .create();

        //2.创建支付宝支付请求
        AliPayReq aliPayReq = new AliPayReq.Builder()
                .with(activity)//Activity实例
                .apply(config)//支付宝支付通用配置
                .setOutTradeNo(outTradeNo)//设置唯一订单号
                .setPrice(price)//设置订单价格
                .setSubject(orderSubject)//设置订单标题
                .setBody(orderBody)//设置订单内容 订单详情
                .setCallbackUrl(callbackUrl)//设置回调地址
                .create()//
                .setOnAliPayListener(null);//

        //3.发送支付宝支付请求
        PayAPI.getInstance().sendPayRequest(aliPayReq);

        //关于支付宝支付的回调
        //aliPayReq.setOnAliPayListener(new OnAliPayListener);
</code></pre>
<h4 id="h4--strong-strong-"><a href='' target='_blank'></a><span class="header-link octicon octicon-link"></span>支付宝支付第二种方式(<strong>强烈推荐</strong>)</h4><pre><code class="lang-java">        //1.创建支付宝支付订单的信息
        String rawAliOrderInfo = new AliPayReq2.AliOrderInfo()
                .setPartner(partner) //商户PID || 签约合作者身份ID
                .setSeller(seller)  // 商户收款账号 || 签约卖家支付宝账号
                .setOutTradeNo(outTradeNo) //设置唯一订单号
                .setSubject(orderSubject) //设置订单标题
                .setBody(orderBody) //设置订单内容
                .setPrice(price) //设置订单价格
                .setCallbackUrl(callbackUrl) //设置回调链接
                .createOrderInfo(); //创建支付宝支付订单信息


        //2.签名  支付宝支付订单的信息 ===&gt;&gt;&gt;  商户私钥签名之后的订单信息
        //TODO 这里需要从服务器获取用商户私钥签名之后的订单信息
        String signAliOrderInfo = getSignAliOrderInfoFromServer(rawAliOrderInfo);

        //3.发送支付宝支付请求
        AliPayReq2 aliPayReq = new AliPayReq2.Builder()
                .with(activity)//Activity实例
                .setRawAliPayOrderInfo(rawAliOrderInfo)//支付宝支付订单信息
                .setSignedAliPayOrderInfo(signAliOrderInfo) //设置 商户私钥RSA加密后的支付宝支付订单信息
                .create()//
                .setOnAliPayListener(null);//
        PayAPI.getInstance().sendPayRequest(aliPayReq);

        //关于支付宝支付的回调
        //aliPayReq.setOnAliPayListener(new OnAliPayListener);
</code></pre>
<h2 id="h2-17e37fc073134bdbac3f5309e226091f">混淆</h2><pre><code class="lang-xml">
#pay_library
-dontwarn io.github.mayubao.pay_library.**
-keep class io.github.mayubao.pay_library.** {*;}

#wechat pay
-dontwarn com.tencent.**
-keep class com.tencent.** {*;}


#alipay
-dontwarn com.alipay.**
-keep class com.alipay.** {*;}

-dontwarn  com.ta.utdid2.**
-keep class com.ta.utdid2.** {*;}

-dontwarn  com.ut.device.**
-keep class com.ut.device.** {*;}

-dontwarn  org.json.alipay.**
-keep class corg.json.alipay.** {*;}
</code></pre>
<h2 id="h2-c23f5afaed824cdea5842036eed48968">文档</h2><h3 id="h3--"><a href='' target='_blank'></a><span class="header-link octicon octicon-link"></span>微信支付官方文档 支付流程</h3><p><a href='https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=8_5' target='_blank'>https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=8_5</a></p>
<h3 id="h3--"><a href='' target='_blank'></a><span class="header-link octicon octicon-link"></span>支付宝支付官方文档 支付流程</h3><p><a href='https://doc.open.alipay.com/docs/doc.htm?spm=a219a.7629140.0.0.sdGXaH&treeId=204&articleId=105296&docType=1' target='_blank'>https://doc.open.alipay.com/docs/doc.htm?spm=a219a.7629140.0.0.sdGXaH&treeId=204&articleId=105296&docType=1</a></p>
<h2 id="h2-d81cacf15f134f0d9f30abd88e94b6b6">注意</h2><h3 id="h3-u5FAEu4FE1u652Fu4ED8"><a href='' target='_blank'></a><span class="header-link octicon octicon-link"></span>微信支付</h3><ul>
<li><p>微信支付必须要在<strong>正式签名</strong>和<strong>正确包名</strong>的应用中才能成功调起。(**重点)</p>
<p> 即商户在微信开放平台申请开发应用后对应包名和对应签名的应用才能成功调起。<br> 详情请参考微信支付的开发流程文档。</p>
<p> <a href='https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=8_5' target='_blank'>https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=8_5</a></p>
</li><li><p>微信支付API没有在客户端显示的设置回调，回调是在Server端设置的。(与支付宝支付的区别，支付宝的回调是在客户端设置的)</p>
</li></ul>
<h3 id="h3-u652Fu4ED8u5B9Du652Fu4ED8"><a href='' target='_blank'></a><span class="header-link octicon octicon-link"></span>支付宝支付</h3><ul>
<li><p>支付宝支付为了保证交易双方的身份和数据安全， 需要配置双方密钥。</p>
<p> 详情请参考支付宝支付的密钥处理体系文档。</p>
<p> <a href='https://doc.open.alipay.com/docs/doc.htm?spm=a219a.7629140.0.0.1wPnBT&treeId=204&articleId=106079&docType=1' target='_blank'>https://doc.open.alipay.com/docs/doc.htm?spm=a219a.7629140.0.0.1wPnBT&treeId=204&articleId=106079&docType=1</a></p>
</li></ul>
<h2 id="h2-0c2e4234932a4938aee0998f6156030a">Lisence</h2><pre><code>Copyright 2017 mayubao

Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre>

                                <br>

                                Github地址 <a href="https://github.com/mayubao/Android-Pay"
                                            target="_blank">mayubao/Android-Pay</a>

                                <div class="github-widget" data-repo="mayubao/Android-Pay"></div>

                                <div style="text-align: center;padding-top: 20px;margin-top: 20px;border-top: 1px solid #EEF2F8;">
                                    <div id="QR" style="display: none;">
                                        <div id="wechat" style="display: inline-block; padding-right: 7px;">
                                            <img id="wechat_qr" src="/usr/themes/yodu/images/weixin.png"
                                                 alt="zhuer0632-656 WeChat Pay">

                                            <p>微信打赏</p></div>
                                        <div id="alipay" style="display: inline-block; padding-left: 7px;">
                                            <img id="alipay_qr" src="/usr/themes/yodu/images/alipay.png"
                                                 alt="zhushaolong@gmail.com Alipay">

                                            <p>支付宝打赏</p></div>
                                    </div>

                                    <div id="ew" style="display: block;">
                                        <div id="erweima" style="display: inline-block">
                                            <div id="qrcode_read"></div>
                                            <p>扫描二维码，在手机上阅读！</p></div>
                                    </div>
                                    <a id="rewardButton" disable="enable"
                                       onclick="var qr = document.getElementById('QR'); var ds = document.getElementById('ew');if (qr.style.display === 'block'){qr.style.display='none';ds.style.display='block'}else{ds.style.display='none';qr.style.display='block'}"
                                       class="shangbutton" target="_blank"> 赏 </a></div>
                            </div>

                            <div class="ad" id="hitokoto"></div>
                        </div>
                        <nav class="detailpager">

                            <a class="btn--one fenx" href="/page/36/docker-web-management-tool-shipyard.html"
                               data-tooltip="Docker的web管理工具 shipyard">
                                <i class="iconfont icon-zuo"></i>
                            </a>

                            <a class="btn--one fenx nextright"
                               href="/page/34/another-version-of-the-node-manager.html"
                               data-tooltip="又一个node版本管理器">
                                <i class="iconfont icon-you"></i>
                            </a>
                            <div class="page-right fenxiang" id="fenxiang">
                                <a class="btn--one two" target="_blank"
                                   href="http://connect.qq.com/widget/shareqq/index.html?url=http://github123.com/page/35/wechat-alipay-android-integrated-payment-and-payment.html&amp;title=Android集成微信支付和支付宝支付&amp;pics="
                                   data-tooltip="分享至QQ好友"><i class="iconfont icon-qq"></i></a>
                                <a class="btn--one two" target="_blank"
                                   href="http://service.weibo.com/share/share.php?url=http://github123.com/page/35/wechat-alipay-android-integrated-payment-and-payment.html&title=Android集成微信支付和支付宝支付&pic="
                                   data-tooltip="分享至新浪微博"><i class="iconfont icon-weibo"></i></a>
                            </div>
                        </nav>
                        <div id="comments">
                            <style>
                                /*邮箱 daodaovps@qq.com*/
                                #ds-thread #ds-reset a.ds-user-name[data-user-id='9030990']:before {
                                    content: "万能的";
                                    margin-right: 8px;
                                    font-size: 12px;
                                    color: #FD0000;
                                    border-radius: 4px
                                }

                                #ds-thread #ds-reset a.ds-user-name[data-user-id='9030990']:after {
                                    content: "博主";
                                    margin-left: 6px;
                                    font-size: 12px;
                                    color: #fff;
                                    background: #66BAB7;
                                    border-radius: 2px;
                                    padding: 0 3px;
                                    box-shadow: 0 0 8px #66BAB0;
                                    opacity: .8;
                                    -webkit-animation: my-face 5s infinite ease-in-out;
                                    animation: my-face 5s infinite ease-in-out;
                                    display: inline-block;
                                    margin: 0 5px
                                }</style>

                            <div class="ds-thread" data-thread-key="35"
                                 data-title="Android集成微信支付和支付宝支付"></div>
                            <script type="text/javascript">
                                var duoshuoQuery = {short_name: "github123", theme: "none"};
                            </script>
                            <script src="/usr/themes/yodu/duoshuo/duoshuo.min.js"></script>
                        </div>
                    </article>

<footer id="footer" class="footer"><br>
    © 2017&nbsp;由&nbsp;
    <a target="_blank" href="http://daodaovps.com">刀刀</a> 强力驱动.&nbsp;
    <br>
    <div style="display: none;"><script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?a26f7d71bb2663bca2b8ef689c02c53f";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script></div>

</footer>

                </div>

                <div class="w3-container w3-col m1 "></div>

                <div class="w3-col l3   w3-padding-48">
                    <div class="widget">
                        <h3 class="sider_header"><strong>热门标签</strong></h3>
                        <ul class="tag-list__itembody taglist--inline multi">
                        <li>
 <a href="/tag/1/1.html" class="tag" data-original-title="Android">
        <span class="name">Android</span>
        <span class="extra"> | 6</span>
   </a>
</li><li>
 <a href="/tag/3/1.html" class="tag" data-original-title="Java">
        <span class="name">Java</span>
        <span class="extra"> | 4</span>
   </a>
</li><li>
 <a href="/tag/5/1.html" class="tag" data-original-title="JavaScript">
        <span class="name">JavaScript</span>
        <span class="extra"> | 4</span>
   </a>
</li><li>
 <a href="/tag/6/1.html" class="tag" data-original-title="Python">
        <span class="name">Python</span>
        <span class="extra"> | 3</span>
   </a>
</li><li>
 <a href="/tag/11/1.html" class="tag" data-original-title="CSS3">
        <span class="name">CSS3</span>
        <span class="extra"> | 2</span>
   </a>
</li><li>
 <a href="/tag/70/1.html" class="tag" data-original-title="Git">
        <span class="name">Git</span>
        <span class="extra"> | 2</span>
   </a>
</li><li>
 <a href="/tag/75/1.html" class="tag" data-original-title="Node">
        <span class="name">Node</span>
        <span class="extra"> | 2</span>
   </a>
</li><li>
 <a href="/tag/77/1.html" class="tag" data-original-title="Google">
        <span class="name">Google</span>
        <span class="extra"> | 2</span>
   </a>
</li><li>
 <a href="/tag/79/1.html" class="tag" data-original-title="Vue">
        <span class="name">Vue</span>
        <span class="extra"> | 2</span>
   </a>
</li><li>
 <a href="/tag/84/1.html" class="tag" data-original-title="iOS">
        <span class="name">iOS</span>
        <span class="extra"> | 2</span>
   </a>
</li><li>
 <a href="/tag/7/1.html" class="tag" data-original-title="Docker">
        <span class="name">Docker</span>
        <span class="extra"> | 1</span>
   </a>
</li><li>
 <a href="/tag/10/1.html" class="tag" data-original-title="HTML5">
        <span class="name">HTML5</span>
        <span class="extra"> | 1</span>
   </a>
</li><li>
 <a href="/tag/12/1.html" class="tag" data-original-title="jQuery">
        <span class="name">jQuery</span>
        <span class="extra"> | 1</span>
   </a>
</li><li>
 <a href="/tag/27/1.html" class="tag" data-original-title="Shell">
        <span class="name">Shell</span>
        <span class="extra"> | 1</span>
   </a>
</li><li>
 <a href="/tag/34/1.html" class="tag" data-original-title="SpringBoot">
        <span class="name">SpringBoot</span>
        <span class="extra"> | 1</span>
   </a>
</li><li>
 <a href="/tag/67/1.html" class="tag" data-original-title="RPC">
        <span class="name">RPC</span>
        <span class="extra"> | 1</span>
   </a>
</li><li>
 <a href="/tag/76/1.html" class="tag" data-original-title="异步编程">
        <span class="name">异步编程</span>
        <span class="extra"> | 1</span>
   </a>
</li><li>
 <a href="/tag/78/1.html" class="tag" data-original-title="工具类">
        <span class="name">工具类</span>
        <span class="extra"> | 1</span>
   </a>
</li><li>
 <a href="/tag/80/1.html" class="tag" data-original-title="文件上传">
        <span class="name">文件上传</span>
        <span class="extra"> | 1</span>
   </a>
</li><li>
 <a href="/tag/81/1.html" class="tag" data-original-title="ORM">
        <span class="name">ORM</span>
        <span class="extra"> | 1</span>
   </a>
</li>
                        </ul>
                    </div>
                    <div class="widget">
                        <h3 class="sider_header"><strong>时间归档</strong></h3>
                        <ul id="ul_datearchive" class="tag-list__itembody taglist--inline multi">
                        <li>
                                <a href="/archive/201703/1.html" class="datearchive">
                                    <span class="name">2017年03月</span>
                                    <span class="extra"> | 33</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>


        </div>
    </div>
</div>


<script src="/usr/themes/yodu/js/jquery.js"></script>
<script src="/usr/themes/yodu/js/load.js"></script>
<script src="/usr/themes/yodu/js/jquery.qrcode.js"></script>
<script src="/usr/themes/yodu/js/qrcode.js"></script>
<script src="/usr/themes/yodu/js/GithubRepoWidget.min.js"></script>

<script>
    $(function () {
        $("#qrcode_read").qrcode(
                {
                    width: 132,
                    height: 132,
                    render: "canvas",
                    foreground: "#08add3",
                    correctLevel: QRErrorCorrectLevel.H,
                    text: "https://github123.com/page/35/wechat-alipay-android-integrated-payment-and-payment.html"
                }
        );
    });
</script>
</body>
</html>
